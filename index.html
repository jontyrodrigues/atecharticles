<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sports Articles - Viewer</title>
  <style>
    :root{
      --thumb-w:280px; --thumb-h:163px;
      --land-w:470px; --land-h:264px; --land-ar:470/264;
      --gap:12px;
      --muted:#6b7280;
      --card-bg:#ffffff;
      --page-bg:#f3f4f6;
      --accent:#0ea5a4;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:var(--page-bg);color:#111;padding:20px}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .sources{display:flex;gap:8px}
    .sources button{background:#fff;border:1px solid #e5e7eb;padding:8px 12px;border-radius:8px;cursor:pointer}
    .sources button.active{border-color:var(--accent);box-shadow:0 2px 6px rgba(14,165,164,0.12)}

    .list{min-width:350px}
    .list .count{color:var(--muted);margin-bottom:8px}
    .article-card{display:flex;gap:var(--gap);background:var(--card-bg);padding:12px;border-radius:10px;margin-bottom:12px;align-items:center;box-shadow:0 1px 0 rgba(2,6,23,0.04)}
    .thumb{width:var(--thumb-w);height:var(--thumb-h);flex:0 0 auto;border-radius:8px;overflow:hidden;background:#efefef}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .meta{flex:1}
    .meta h3{margin:0;font-size:16px}
    .meta .date{color:var(--muted);font-size:13px;margin-top:6px}
    .meta .actions{margin-top:10px}
    .meta .actions button{background:transparent;border:none;color:var(--accent);cursor:pointer;padding:6px 8px;border-radius:6px}

    /* Full-page overlay fallback when popup is blocked */
    .overlay{position:fixed;inset:0;display:none;align-items:flex-start;justify-content:center;padding:40px;background:rgba(2,6,23,0.6);z-index:999}
    .overlay.open{display:flex}
    .overlay .card{background:#fff;border-radius:10px;padding:18px;max-width:920px;width:100%;max-height:90vh;overflow:auto}
    .overlay img{width:100%;aspect-ratio:var(--land-ar);height:auto;object-fit:cover;border-radius:8px;margin-bottom:12px}
    .overlay .close{position:absolute;right:24px;top:20px;background:transparent;border:none;font-size:22px;color:#fff;cursor:pointer}
    .overlay h2{margin-top:0}

  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Sports Articles Viewer</h1>
      <div style="flex:1"></div>
      <div class="sources" role="tablist" aria-label="Sports sources">
        <button data-src="https://alinetech.net/api/secv1/cricket/articles.xml" class="active">Cricket</button>
        <button data-src="https://alinetech.net/api/secv1/football/articles.xml">Football</button>
        <button data-src="https://alinetech.net/api/secv1/basketball/articles.xml">Basketball</button>
        <button data-src="https://alinetech.net/api/secv1/rugby/articles.xml">Rugby</button>
      </div>
    </header>

    <div class="list">
      <div class="count">Select a sport to load articles</div>
      <div id="articles"></div>
    </div>
  </div>

  <!-- Overlay fallback used when window.open() returns null (popup blocked) -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <button id="overlayClose" class="close" aria-label="Close">✕</button>
    <div class="card" role="dialog" aria-modal="true">
      <img id="overlayImage" src="" alt="Article image">
      <h2 id="overlayTitle"></h2>
      <div id="overlayDate" style="color:var(--muted);margin-bottom:12px"></div>
      <div id="overlayContent" style="white-space:pre-wrap;line-height:1.5"></div>
    </div>
  </div>

<script>
function parseXML(text){ return new DOMParser().parseFromString(text,'application/xml'); }
async function fetchArticles(url){
  const res = await fetch(url,{cache:'no-store'});
  if(!res.ok) throw new Error('Failed: '+res.status);
  const doc = parseXML(await res.text());
  return Array.from(doc.querySelectorAll('article')).map(a=>({
    id: a.querySelector('id')?.textContent.trim()||'',
    title: a.querySelector('title')?.textContent.trim()||'',
    date: a.querySelector('date')?.textContent.trim()||'',
    content: a.querySelector('content')?.textContent.trim()||'',
    landscape: a.querySelector('image[format="landscape"]')?.textContent.trim()||'',
    thumb: a.querySelector('image[format="thumbnail"]')?.textContent.trim()||''
  }));
}

const srcButtons=document.querySelectorAll('.sources button');
const countEl=document.querySelector('.count');
const articlesEl=document.getElementById('articles');

async function loadSource(btn){
  srcButtons.forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  countEl.textContent='Loading...';
  articlesEl.innerHTML='';
  try{
    const arts=await fetchArticles(btn.dataset.src);
    countEl.textContent=arts.length+' articles loaded';
    renderList(arts);
  }catch(e){countEl.textContent='Error: '+e.message;}
}

function renderList(arts){
  articlesEl.innerHTML='';
  arts.forEach(a=>{
    const card=document.createElement('div');card.className='article-card';
    const thumb=document.createElement('div');thumb.className='thumb';
    const img=document.createElement('img');img.src=a.thumb||a.landscape;img.alt=a.title;thumb.appendChild(img);
    const meta=document.createElement('div');meta.className='meta';
    const h3=document.createElement('h3');h3.textContent=a.title;
    const date=document.createElement('div');date.className='date';date.textContent=a.date;
    const act=document.createElement('div');act.className='actions';
    const view=document.createElement('button');view.textContent='View';
    view.onclick=()=>openArticlePage(a);
    act.appendChild(view);
    meta.append(h3,date,act);
    card.append(thumb,meta);
    articlesEl.appendChild(card);

    // also allow clicking thumbnail to open
    img.style.cursor='pointer';
    img.addEventListener('click', ()=>openArticlePage(a));
  });
}

// Overlay helpers (fallback) ------------------------------------------------
const overlay=document.getElementById('overlay');
const overlayImage=document.getElementById('overlayImage');
const overlayTitle=document.getElementById('overlayTitle');
const overlayDate=document.getElementById('overlayDate');
const overlayContent=document.getElementById('overlayContent');
const overlayClose=document.getElementById('overlayClose');
overlayClose.addEventListener('click', closeOverlay);
overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeOverlay(); });
function openOverlay(a){
  overlayImage.src = a.landscape || a.thumb || '';
  overlayTitle.textContent = a.title || '';
  overlayDate.textContent = a.date || '';
  overlayContent.textContent = a.content || '';
  overlay.classList.add('open');
  overlay.setAttribute('aria-hidden','false');
}
function closeOverlay(){ overlay.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); }

// Primary open: try to open a new tab/window. If blocked (page === null) fall back to overlay.
function openArticlePage(a){
  const html = `<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>${escapeHtml(a.title)}</title><style>body{font-family:Arial,system-ui;padding:20px;max-width:900px;margin:auto;background:#f9fafb;color:#111}img{width:100%;aspect-ratio:470/264;height:auto;object-fit:cover;border-radius:8px;display:block;margin-bottom:16px}h1{font-size:22px;margin-bottom:8px}time{color:#6b7280;font-size:14px}p{line-height:1.5;white-space:pre-wrap}a.back{display:inline-block;margin-top:12px;color:#0ea5a4;text-decoration:none}</style></head><body><img src='${escapeAttr(a.landscape||a.thumb||'')}' alt=''><h1>${escapeHtml(a.title)}</h1><time>${escapeHtml(a.date)}</time><p>${escapeHtml(a.content)}</p><a href="#" class="back" onclick="history.back();return false;">Back</a></body></html>`;

  let page = null;
  try{
    page = window.open('','_blank');
  }catch(e){
    page = null;
  }

  if(page && page.document){
    // we have a popup window — write the HTML into it
    page.document.open();
    page.document.write(html);
    page.document.close();
  }else{
    // popup blocked or unavailable — use in-page overlay fallback
    console.warn('Popup blocked or window.open failed; using overlay fallback');
    openOverlay(a);
  }
}

// small HTML-escaping helpers
function escapeHtml(str){
  if(!str) return '';
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}
function escapeAttr(str){ return escapeHtml(str); }

// wire up source buttons
srcButtons.forEach(b=>b.addEventListener('click',()=>loadSource(b)));
window.addEventListener('DOMContentLoaded',()=>loadSource(srcButtons[0]));
</script>
</body>
</html>
